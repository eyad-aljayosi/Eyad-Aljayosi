<!DOCTYPE HTML>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تحدي الأرقام - اكتشف النمط</title>
    <style>
      :root {
        --primary: #3498db;
        --danger: #e74c3c;
        --success: #2ecc71;
        --warning: #f39c12;
        --dark: #2c3e50;
        --light: #ecf0f1;
      }
      
      body {
        font-family: 'Tahoma', Arial, sans-serif;
        background-color: #f4f4f9;
        margin: 0;
        padding: 20px;
        line-height: 1.6;
      }
      
      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
      }
      
      h1, h3 {
        text-align: center;
        color: var(--dark);
      }
      
      h1 {
        color: var(--primary);
        margin-bottom: 30px;
      }
      
      .alert {
        padding: 15px;
        margin: 20px 0;
        border-radius: 4px;
        text-align: center;
      }
      
      .alert-danger {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      
      .alert-warning {
        background-color: #fff3cd;
        color: #856404;
        border: 1px solid #ffeeba;
      }
      
      .alert-info {
        background-color: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      
      .alert-success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      
      .flag {
        font-size: 24px;
        color: var(--success);
        text-align: center;
        margin: 30px 0;
        padding: 20px;
        background-color: #f8f9fa;
        border: 2px dashed var(--success);
        border-radius: 4px;
        font-family: monospace;
      }
      
      .hint {
        text-align: center;
        font-size: 16px;
        margin: 15px 0;
        color: var(--dark);
        padding: 10px;
        background-color: #f8f9fa;
        border-radius: 4px;
      }
      
      .progress-container {
        width: 100%;
        background-color: #e0e0e0;
        border-radius: 5px;
        margin: 20px 0;
      }
      
      .progress-bar {
        height: 10px;
        border-radius: 5px;
        background-color: var(--primary);
        width: 0%;
        transition: width 0.3s;
      }
      
      .hidden {
        display: none;
      }
      
      .attempts {
        text-align: center;
        font-size: 14px;
        color: #7f8c8d;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>تحدي اكتشاف النمط</h1>
      <h3>هل يمكنك اكتشاف النمط الصحيح للحصول على العلم؟</h3>
      
      <?php
      // إعداد العلم (flag)
      $flag = "FLAG{THE-PATTERN-IS-KEY-TO-SUCCESS}";
      $attempts = isset($_COOKIE['attempts']) ? (int)$_COOKIE['attempts'] : 0;
      
      // التحقق من وجود المعامل 'number' في الرابط
      if (isset($_GET['number'])) {
          $dev = filter_input(INPUT_GET, 'number', FILTER_SANITIZE_STRING);
          $attempts++;
          setcookie('attempts', $attempts, time() + 3600, '/');
          
          // التحقق من أن المدخل عدد
          if (is_numeric($dev)) {
              // التحقق من أن المدخل ليس عشريًا
              if (!strpos($dev, ".")) {
                  // التحقق من طول الرقم
                  $length = strlen($dev);
                  
                  if ($length == 6) {
                      // التحقق من أن الرقم بين 900000 و 999999
                      if ($dev >= 900000 && $dev <= 999999) {
                          // عرض العلم إذا كانت الشروط مستوفاة
                          echo '<div class="alert alert-success">تهانينا! لقد اكتشفت النمط الصحيح.</div>';
                          echo '<div class="flag">العلم: ' . htmlspecialchars($flag) . '</div>';
                      } else {
                          // رسالة إذا كان الرقم خارج النطاق المطلوب
                          echo '<div class="alert alert-warning">الرقم خارج النطاق المطلوب (900000-999999). هل لاحظت شيئًا غريبًا في الرسالة السابقة؟</div>';
                          echo '<div class="hint">تلميح: انظر إلى رسائل الخطأ بعناية، قد تحتوي على أدلة</div>';
                      }
                  } elseif ($length < 6) {
                      // رسالة إذا كان الرقم أقصر من 6 خانات
                      echo '<div class="alert alert-danger">الرقم قصير جدًا! جرب رقمًا أطول.</div>';
                      echo '<div class="progress-container"><div class="progress-bar" style="width: ' . ($length/6*100) . '%"></div></div>';
                      echo '<div class="hint">تلميح: الرقم المطلوب يتكون من 6 خانات بالضبط</div>';
                  } elseif ($length > 6) {
                      // رسالة إذا كان الرقم أطول من 6 خانات
                      echo '<div class="alert alert-danger">الرقم طويل جدًا! جرب رقمًا أقصر.</div>';
                      echo '<div class="progress-container"><div class="progress-bar" style="width: 100%"></div></div>';
                      echo '<div class="hint">تلميح: الرقم المثالي يتكون من 6 خانات فقط</div>';
                  }
              } else {
                  // رسالة إذا كان الرقم عشريًا
                  echo '<div class="alert alert-warning">الأرقام العشرية غير مقبولة! جرب رقمًا صحيحًا.</div>';
                  echo '<div class="hint">تلميح: يجب أن يكون الرقم صحيحًا (بدون فاصلة عشرية)</div>';
              }
          } else {
              // رسالة إذا كان المدخل غير عدد
              echo '<div class="alert alert-danger">المدخل يجب أن يكون رقميًا فقط!</div>';
              echo '<div class="hint">تلميح: حاول فهم الشروط المطلوبة من خلال تحليل الكود</div>';
          }
      } else {
          // رسالة إذا لم يتم تمرير المعامل 'number' في الرابط
          echo '<div class="alert alert-info">لم يتم تحديد رقم! جرب إضافة ?number=رقم_ما إلى نهاية الرابط</div>';
          echo '<div class="hint">ابدأ بتجربة أرقام مختلفة وتحقق من الاستجابة</div>';
      }
      
      echo '<div class="attempts">عدد المحاولات: ' . $attempts . '</div>';
      ?>
      
      <div class="hint hidden" id="advancedHint">
        <h4>تلميح متقدم:</h4>
        <p>ابحث عن نمط معين في الأرقام. ليس فقط أي رقم من 6 خانات بين 900000 و 999999 سيعمل!</p>
      </div>
    </div>
    
    <script>
      // إظهار التلميح المتقدم بعد 5 محاولات
      if (<?php echo $attempts; ?> >= 5) {
        document.getElementById('advancedHint').classList.remove('hidden');
      }
    </script>
  </body>
</html>